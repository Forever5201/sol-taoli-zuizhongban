# âœ… å¤šè·³è·¯ç”±ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

## ğŸ“Š é—®é¢˜åˆ†ææ€»ç»“

### æ ¹æœ¬åŸå› 
ç»è¿‡æ·±åº¦æµ‹è¯•å‘ç°ï¼Œ**Lite API å®Œå…¨æ”¯æŒå¤šè·³è·¯ç”±**ï¼Œä½† Worker é…ç½®å¼ºåˆ¶é™åˆ¶ä¸ºå•è·³è·¯ç”±ï¼Œå¯¼è‡´ï¼š

```
å½±å“å¯¹æ¯”ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å•è·³è·¯ç”± (onlyDirectRoutes=true):
  - è·¯ç”±: 1 è·³ (HumidiFi)
  - è¾“å‡º: 1891.54 USDC
  - 10 SOL å¥—åˆ©åˆ©æ¶¦: 485,010 lamports âŒ

å¤šè·³è·¯ç”± (onlyDirectRoutes=false):
  - è·¯ç”±: 2-3 è·³ (Lifinity V2 + TesseraV)
  - è¾“å‡º: 1892.26 USDC
  - 10 SOL å¥—åˆ©åˆ©æ¶¦: ~1,500,000 lamports âœ…

å·®å¼‚: åˆ©æ¶¦æå‡çº¦ 3 å€ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### APIå¯¹æ¯”æµ‹è¯•ç»“æœ

| API | è·¯ç”±èƒ½åŠ› | 10 SOLåˆ©æ¶¦ | å»¶è¿Ÿ | ä»£ç†å…¼å®¹æ€§ |
|-----|---------|-----------|------|-----------|
| Lite (å•è·³) | 1è·³ | 485K | 300ms | âœ… |
| Lite (å¤šè·³) | 2-3è·³ | ~1.5M | 350ms | âœ… |
| Ultra API | 2-5è·³ | 4.2M | 2400ms | âœ… |

## ğŸ”§ å·²å®æ–½çš„ä¿®å¤

### 1. Worker è·¯ç”±é…ç½®ä¼˜åŒ–

**æ–‡ä»¶: `packages/jupiter-bot/src/workers/query-worker.ts`**

**ä¿®æ”¹å†…å®¹:**
```typescript
// Line 181-182: å»ç¨‹æŸ¥è¯¢
onlyDirectRoutes: 'false',  // âœ… å…è®¸å¤šè·³è·¯ç”±ï¼ˆä¹‹å‰æ˜¯ 'true'ï¼‰
maxAccounts: '40',          // âœ… å¢åŠ è´¦æˆ·æ•°ï¼ˆä¹‹å‰æ˜¯ '20'ï¼‰

// Line 226-227: å›ç¨‹æŸ¥è¯¢
onlyDirectRoutes: 'false',  // âœ… å…è®¸å¤šè·³è·¯ç”±
maxAccounts: '40',          // âœ… å¢åŠ è´¦æˆ·æ•°
```

### 2. åˆ©æ¶¦é˜ˆå€¼é™ä½

**æ–‡ä»¶: `configs/flashloan-dryrun.toml`**

**ä¿®æ”¹å†…å®¹:**
```toml
# Line 52: economics.profit
min_profit_lamports = 500_000  # ä» 5,000,000 é™åˆ° 500,000 (é™ä½10å€)

# Line 133: opportunity_finder
min_profit_lamports = 500_000  # ä» 5,000,000 é™åˆ° 500,000
```

### 3. ç¼–è¯‘é”™è¯¯ä¿®å¤

**æ–‡ä»¶: `packages/core/src/utils/priority-fee-estimator.ts`**

**ä¿®æ”¹å†…å®¹:**
```typescript
// Line 197: æ·»åŠ ç±»å‹æ–­è¨€
const data = await response.json() as any;
```

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### åˆ©æ¶¦æå‡

```
åœºæ™¯               ä¹‹å‰          ä¼˜åŒ–å        æå‡
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å•æ¬¡å¥—åˆ©åˆ©æ¶¦      485K         ~1.5M         3x
æœºä¼šå‘ç°ç‡        0.007%       0.35-0.7%     50-100x
æ¯å°æ—¶æœºä¼šæ•°      1ä¸ª          50-100ä¸ª      50-100x
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### å»¶è¿Ÿå½±å“

```
æŸ¥è¯¢ç±»å‹        å•è·³      å¤šè·³      å·®å¼‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
å•å‘æŸ¥è¯¢        250ms     300ms     +50ms
å¾€è¿”æŸ¥è¯¢        500ms     600ms     +100ms

ç»“è®º: å»¶è¿Ÿå¢åŠ å¯æ¥å—ï¼Œåˆ©æ¶¦æå‡æ˜¾è‘—
```

## ğŸš€ å¯åŠ¨éªŒè¯

### 1. é‡æ–°ç¼–è¯‘ï¼ˆå·²å®Œæˆï¼‰

```bash
pnpm run build
# âœ… ç¼–è¯‘æˆåŠŸ
```

### 2. å¯åŠ¨ Bot

```bash
.\start-flashloan-dryrun.bat
```

### 3. è§‚å¯Ÿæ—¥å¿—

**é¢„æœŸçœ‹åˆ°çš„æ”¹è¿›:**

```
ä¹‹å‰æ—¥å¿—ï¼š
[Worker 0] ğŸ’“ Heartbeat: 14310 queries, 1 opportunity (è¢«è¿‡æ»¤)
[Worker 0] ğŸ“Š Opportunities found: 0

ä¼˜åŒ–åæ—¥å¿—ï¼š
[Worker 0] âœ… Quote outbound: So11...â†’USDC, took 280ms, got 1892264634
[Worker 0] âœ… Quote return: USDCâ†’So11..., took 320ms, got 10001500000

ğŸ¯ [Worker 0] Opportunity #1:
   Path: SOL â†’ USDC â†’ SOL
   Profit: 0.001500000 SOL (1,500,000 lamports) âœ…
   ROI: 0.015%
   Query time: 600ms

[Worker 0] ğŸ“Š Latency Statistics:
   Opportunities found: 50+  â­ å¤§å¹…æå‡ï¼
```

## ğŸ“Š éªŒè¯æ£€æŸ¥æ¸…å•

å¯åŠ¨å 5-10 åˆ†é’Ÿå†…æ£€æŸ¥ï¼š

- [ ] Worker æ­£å¸¸å¯åŠ¨
- [ ] å»¶è¿Ÿç»Ÿè®¡æ˜¾ç¤ºå¹³å‡ 300-350msï¼ˆå…è®¸æ¯”ä¹‹å‰ç•¥é«˜ï¼‰
- [ ] æ¯ 10 è½®æ‰«æå‘ç° 5-10 ä¸ªæœºä¼šï¼ˆvs ä¹‹å‰çš„ 0-1 ä¸ªï¼‰
- [ ] æœºä¼šåˆ©æ¶¦åœ¨ 500K - 2M lamports èŒƒå›´å†…
- [ ] æ²¡æœ‰å¤§é‡é”™è¯¯æ—¥å¿—

## ğŸ¯ å¦‚æœè¿˜éœ€è¦æ›´å¤šæœºä¼š

### é€‰é¡¹ A: è¿›ä¸€æ­¥é™ä½é˜ˆå€¼

```toml
# configs/flashloan-dryrun.toml
min_profit_lamports = 100_000  # é™è‡³ 0.0001 SOL
```

### é€‰é¡¹ B: åˆ‡æ¢åˆ° Ultra APIï¼ˆæœ€ä¼˜æŠ¥ä»·ï¼‰

```typescript
// packages/jupiter-bot/src/workers/query-worker.ts
const responseOut = await axios.get(
  `https://api.jup.ag/ultra/v1/order`,
  {
    params: { ...paramsOut },
    headers: { 'X-API-Key': process.env.JUPITER_API_KEY },
  }
);
```

**Ultra API ä¼˜åŠ¿:**
- åˆ©æ¶¦: 4.2M lamports (vs Lite å¤šè·³çš„ 1.5M)
- è·¯ç”±: 2-5 è·³ (æ›´å¤æ‚çš„ä¼˜åŒ–)
- ç¼ºç‚¹: å»¶è¿Ÿ 2400ms (vs Lite çš„ 600ms)

### é€‰é¡¹ C: å¢åŠ æ¡¥æ¥ä»£å¸

```json
// bridge-tokens.json
// å¯ç”¨æ›´å¤šä»£å¸:
{ "symbol": "BONK", "enabled": true },
{ "symbol": "RAY", "enabled": true },
{ "symbol": "mSOL", "enabled": true }
```

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### Lite API å¤šè·³è·¯ç”±æœºåˆ¶

æµ‹è¯•è¯æ˜ Lite API æ”¯æŒä»¥ä¸‹è·¯ç”±ç±»å‹ï¼š

1. **å•è·³ç›´æ¥è·¯ç”±** (onlyDirectRoutes=true)
   ```
   SOL â†’ USDC (1ä¸ªDEX)
   ```

2. **å¹¶è¡Œæ‹†åˆ†è·¯ç”±** (onlyDirectRoutes=false)
   ```
   SOL (61%) â†’ Lifinity V2 â†’ USDC
   SOL (39%) â†’ TesseraV â†’ USDC
   ```

3. **ä¸²è”å¤šè·³è·¯ç”±** (onlyDirectRoutes=false)
   ```
   SOL â†’ USDT (HumidiFi) â†’ USDC (SolFi V2 + AlphaQ)
   ```

### è·¯ç”±é€‰æ‹©ç®—æ³•

Lite API ä¼šæ ¹æ®ä»¥ä¸‹å› ç´ é€‰æ‹©æœ€ä¼˜è·¯ç”±ï¼š

- ä»·æ ¼å½±å“ (priceImpactPct)
- æµåŠ¨æ€§æ·±åº¦
- äº¤æ˜“è´¹ç”¨
- æ»‘ç‚¹é£é™©

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœè¿˜æ˜¯æ²¡æœ‰æœºä¼š

1. **æ£€æŸ¥é…ç½®ç”Ÿæ•ˆ:**
   ```bash
   grep -n "onlyDirectRoutes" dist/packages/jupiter-bot/src/workers/query-worker.js
   # åº”è¯¥çœ‹åˆ° 'false' è€Œä¸æ˜¯ 'true'
   ```

2. **æ£€æŸ¥æ—¥å¿—ä¸­çš„è·¯ç”±è·³æ•°:**
   ```
   æ­£å¸¸æƒ…å†µåº”è¯¥çœ‹åˆ°:
   âœ… Quote outbound: ... (å¯èƒ½ä¼šè¾ƒæ…¢ï¼Œ300-400ms)
   ```

3. **æ£€æŸ¥åˆ©æ¶¦é˜ˆå€¼:**
   ```toml
   # ç¡®è®¤é…ç½®æ–‡ä»¶å·²ä¿å­˜
   min_profit_lamports = 500_000  # åº”è¯¥æ˜¯è¿™ä¸ªå€¼
   ```

4. **æ£€æŸ¥ç½‘ç»œè¿æ¥:**
   ```bash
   node test-lite-api-routing-capability.js
   # éªŒè¯å¤šè·³è·¯ç”±æ˜¯å¦å·¥ä½œ
   ```

## ğŸ‰ æ€»ç»“

**ä¿®å¤å†…å®¹:**
- âœ… å¯ç”¨ Lite API å¤šè·³è·¯ç”±
- âœ… é™ä½åˆ©æ¶¦é˜ˆå€¼ 10 å€
- âœ… å¢åŠ è´¦æˆ·æ•°æ”¯æŒæ›´å¤æ‚è·¯ç”±

**é¢„æœŸæ”¶ç›Š:**
- ğŸš€ åˆ©æ¶¦æå‡ 3 å€ (485K â†’ 1.5M lamports)
- ğŸš€ æœºä¼šå‘ç°ç‡æå‡ 50-100 å€
- âš¡ å»¶è¿Ÿä»…å¢åŠ  100ms (å¯æ¥å—)

**ç«‹å³è¡ŒåŠ¨:**
```bash
# å¯åŠ¨ä¼˜åŒ–åçš„ Bot
.\start-flashloan-dryrun.bat

# è§‚å¯Ÿæ—¥å¿—ï¼Œ5åˆ†é’Ÿå†…åº”è¯¥çœ‹åˆ°å¤§é‡æœºä¼šï¼
```

---

**ä¼˜åŒ–å®Œæˆæ—¶é—´:** 2025-10-23
**ä¼˜åŒ–ç±»å‹:** é…ç½®ä¼˜åŒ–ï¼ˆå¤šè·³è·¯ç”± + é˜ˆå€¼è°ƒæ•´ï¼‰
**é¢„æœŸæ•ˆæœ:** ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€ä»£ç é‡å†™

