# æ•°æ®åº“è¿æ¥é…ç½®æŒ‡å—

## ğŸ”´ å½“å‰é—®é¢˜

æ•°æ®åº“è¿æ¥å¤±è´¥ï¼ŒåŸå› ï¼šPostgreSQLç”¨æˆ·åæˆ–å¯†ç ä¸æ­£ç¡®ã€‚

```
Authentication failed against database server at `localhost`
```

## ğŸ” æŸ¥æ‰¾PostgreSQLå¯†ç 

### æ–¹æ³•1ï¼šä½¿ç”¨PostgreSQLå®‰è£…æ—¶è®¾ç½®çš„å¯†ç 

å›å¿†æ‚¨åœ¨å®‰è£…PostgreSQLæ—¶è®¾ç½®çš„è¶…çº§ç”¨æˆ·ï¼ˆpostgresï¼‰å¯†ç ã€‚

### æ–¹æ³•2ï¼šé‡ç½®PostgreSQLå¯†ç ï¼ˆå¦‚æœå¿˜è®°äº†ï¼‰

ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShellï¼š

```powershell
# 1. æ‰¾åˆ°PostgreSQLå®‰è£…ç›®å½•
$pgPath = "C:\Program Files\PostgreSQL\18\bin"  # æ ¹æ®æ‚¨çš„ç‰ˆæœ¬è°ƒæ•´

# 2. ä½¿ç”¨pg_ctlé‡ç½®å¯†ç 
cd $pgPath
.\psql.exe -U postgres

# å¦‚æœèƒ½ç›´æ¥ç™»å½•ï¼ˆæ²¡æœ‰å¯†ç ä¿æŠ¤ï¼‰ï¼Œåˆ™æ‰§è¡Œï¼š
ALTER USER postgres WITH PASSWORD 'your_new_password';
```

### æ–¹æ³•3ï¼šä½¿ç”¨pgAdminæŸ¥çœ‹

å¦‚æœå®‰è£…äº†pgAdminï¼š
1. æ‰“å¼€pgAdmin
2. å³é”® "PostgreSQL 18" â†’ Properties
3. æŸ¥çœ‹è¿æ¥ä¿¡æ¯

## âœ… é…ç½®æ•°æ®åº“è¿æ¥

ä¸€æ—¦ç¡®è®¤äº†å¯†ç ï¼Œéœ€è¦æ›´æ–°é…ç½®æ–‡ä»¶ã€‚

### æ­¥éª¤1ï¼šæ›´æ–°é…ç½®æ–‡ä»¶

ç¼–è¾‘ `configs/flashloan-dryrun.toml`ï¼Œæ‰¾åˆ°ï¼š

```toml
[database]
enabled = true
url = "postgresql://postgres:postgres@localhost:5432/postgres?schema=public"
               #             ^^^^^^^^ 
               #             è¿™é‡Œæ›¿æ¢ä¸ºæ‚¨çš„å®é™…å¯†ç 
```

### æ­¥éª¤2ï¼šæµ‹è¯•è¿æ¥

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
npx tsx E:\6666666666666666666666666666\dex-cex\dex-sol\test-database-connection.ts
```

åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸï¼
ğŸ“‹ å·²å­˜åœ¨çš„è¡¨ (...)
ğŸ“Š æ•°æ®ç»Ÿè®¡:
   - æœºä¼šè®°å½•: 0 æ¡
   - éªŒè¯è®°å½•: 0 æ¡
ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼æ•°æ®åº“å·²å°±ç»ªã€‚
```

## ğŸ¯ å¸¸è§æ•°æ®åº“URLæ ¼å¼

```
postgresql://[ç”¨æˆ·å]:[å¯†ç ]@[ä¸»æœº]:[ç«¯å£]/[æ•°æ®åº“å]

ç¤ºä¾‹ï¼š
postgresql://postgres:mypassword@localhost:5432/postgres
postgresql://arbitrage_user:secret123@localhost:5432/arbitrage_db
```

## ğŸ”’ å®‰å…¨å»ºè®®

### é€‰é¡¹1ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰

1. åœ¨é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨å ä½ç¬¦ï¼š
```toml
url = "${DATABASE_URL}"
```

2. è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼š
```
å˜é‡åï¼šDATABASE_URL
å˜é‡å€¼ï¼špostgresql://postgres:your_password@localhost:5432/postgres
```

### é€‰é¡¹2ï¼šä½¿ç”¨å•ç‹¬çš„é…ç½®æ–‡ä»¶

åˆ›å»º `configs/database-secret.toml`ï¼ˆå·²åœ¨.gitignoreä¸­ï¼‰ï¼š
```toml
[database]
url = "postgresql://postgres:your_real_password@localhost:5432/postgres"
```

ç„¶ååœ¨ä¸»é…ç½®ä¸­å¼•ç”¨ã€‚

## ğŸ› ï¸ å¿«é€Ÿä¿®å¤è„šæœ¬

åˆ›å»º `setup-database.bat`ï¼š

```batch
@echo off
echo ================================
echo PostgreSQL æ•°æ®åº“è®¾ç½®
echo ================================
echo.

set /p DB_PASSWORD="è¯·è¾“å…¥PostgreSQLçš„postgresç”¨æˆ·å¯†ç : "

echo.
echo æ­£åœ¨æµ‹è¯•è¿æ¥...
psql -U postgres -d postgres -c "SELECT version();"

if %ERRORLEVEL% equ 0 (
    echo âœ… è¿æ¥æˆåŠŸï¼
    echo.
    echo è¯·å°†ä»¥ä¸‹URLå¤åˆ¶åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼š
    echo postgresql://postgres:%DB_PASSWORD%@localhost:5432/postgres
) else (
    echo âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥å¯†ç 
)

pause
```

## ğŸ“Š éªŒè¯æ•°æ®åº“å°±ç»ª

è¿æ¥æˆåŠŸåï¼ŒPrismaä¼šè‡ªåŠ¨åˆ›å»ºæ‰€éœ€çš„è¡¨ï¼š

- `Opportunity` - æœºä¼šè®°å½•
- `OpportunityValidation` - éªŒè¯è®°å½•  
- `Trade` - äº¤æ˜“è®°å½•

å¯ä»¥ä½¿ç”¨Prisma StudioæŸ¥çœ‹ï¼š

```bash
cd packages/core
npx prisma studio
```

ç„¶åè®¿é—®ï¼š`http://localhost:5555`

## ğŸš€ å®Œæˆå

æ•°æ®åº“é…ç½®å®Œæˆåï¼Œé‡å¯é—ªç”µè´·æœºå™¨äººï¼š

```bash
start-flashloan-dryrun.bat
```

åº”è¯¥çœ‹åˆ°ï¼š

```
âœ… Database initialized for opportunity recording
```

è€Œä¸æ˜¯ï¼š

```
âŒ Authentication failed
```

---

**ä¸‹ä¸€æ­¥**ï¼šç¡®è®¤PostgreSQLå¯†ç ï¼Œæ›´æ–°é…ç½®æ–‡ä»¶ï¼Œé‡æ–°æµ‹è¯•ï¼

