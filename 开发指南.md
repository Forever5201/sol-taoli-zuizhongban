# å¥—åˆ©æœºå™¨äººæœ¬åœ°å¼€å‘æŒ‡å—

## ğŸ‰ æ­å–œï¼æ‚¨çš„å¼€å‘ç¯å¢ƒå·²å°±ç»ª

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼Œå¯ä»¥å¼€å§‹å¼€å‘äº†ï¼

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
dex-sol/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒåŠŸèƒ½ï¼ˆå·²ç¼–è¯‘âœ…ï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ solana/    # Solanaé›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ economics/ # ç»æµæ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ config/    # é…ç½®ç³»ç»Ÿï¼ˆå«ä»£ç†ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ logger/    # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ dist/          # ç¼–è¯‘è¾“å‡º
â”‚   â””â”€â”€ onchain-bot/       # é“¾ä¸Šæœºå™¨äººï¼ˆå·²ç¼–è¯‘âœ…ï¼‰
â”‚       â””â”€â”€ src/executors/ # Jitoæ‰§è¡Œå™¨
â”‚
â”œâ”€â”€ configs/               # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ devnet-test.toml  # Devnetæµ‹è¯•é…ç½®âœ…
â”‚   â””â”€â”€ global.toml       # å…¨å±€é…ç½®
â”‚
â”œâ”€â”€ keypairs/             # æµ‹è¯•é’±åŒ…
â”‚   â””â”€â”€ devnet-test-wallet.json  # å·²ç”Ÿæˆâœ…
â”‚
â”œâ”€â”€ examples/             # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ test-jupiter-swap.ts    # Jupiteræµ‹è¯•
â”‚   â””â”€â”€ economics-demo.ts       # ç»æµæ¨¡å‹æ¼”ç¤º
â”‚
â”œâ”€â”€ scripts/              # å·¥å…·è„šæœ¬
â”‚   â””â”€â”€ generate-keypair.js     # é’±åŒ…ç”Ÿæˆ
â”‚
â”œâ”€â”€ test-local-complete.js      # æœ¬åœ°å®Œæ•´æµ‹è¯•âœ…
â”œâ”€â”€ .env                         # ç¯å¢ƒå˜é‡ï¼ˆä»£ç†é…ç½®ï¼‰âœ…
â””â”€â”€ package.json
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### **å¼€å‘å‘½ä»¤**

```bash
# ç¼–è¯‘ä»£ç 
npm run build

# è¿è¡Œæœ¬åœ°æµ‹è¯•
node test-local-complete.js

# ç”Ÿæˆæ–°é’±åŒ…
node scripts/generate-keypair.js

# æ¸…ç†ç¼–è¯‘äº§ç‰©
npm run clean
```

### **æµ‹è¯•å‘½ä»¤**

```bash
# æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆæ— éœ€ç½‘ç»œï¼‰
node test-local-complete.js  # âœ… å·²é€šè¿‡

# ç½‘ç»œè¯Šæ–­
node test-network-simple.js

# Jupiteræµ‹è¯•ï¼ˆéœ€è¦ç½‘ç»œï¼‰
node test-jupiter-with-proxy.js
```

---

## ğŸ“ å¼€å‘å·¥ä½œæµ

### **å…¸å‹å¼€å‘æµç¨‹ï¼š**

1. **ä¿®æ”¹ä»£ç **
   ```bash
   # ç¼–è¾‘ packages/core/src/ æˆ– packages/onchain-bot/src/
   code packages/core/src/solana/jupiter-swap.ts
   ```

2. **ç¼–è¯‘**
   ```bash
   npm run build
   ```

3. **æµ‹è¯•**
   ```bash
   node test-local-complete.js
   ```

4. **è°ƒè¯•**
   - æŸ¥çœ‹æµ‹è¯•è¾“å‡º
   - ä¿®æ”¹ä»£ç 
   - é‡æ–°ç¼–è¯‘å’Œæµ‹è¯•

---

## ğŸ¨ æ·»åŠ æ–°ç­–ç•¥

### **ç¤ºä¾‹ï¼šæ·»åŠ ç®€å•å¥—åˆ©ç­–ç•¥**

åˆ›å»ºæ–‡ä»¶ï¼š`packages/onchain-bot/src/strategies/simple-arb.ts`

```typescript
/**
 * ç®€å•å¥—åˆ©ç­–ç•¥
 */

import { PublicKey } from '@solana/web3.js';

export interface ArbitrageOpportunity {
  tokenA: PublicKey;
  tokenB: PublicKey;
  profitSOL: number;
  route: string[];
}

export class SimpleArbitrageStrategy {
  private minProfitSOL: number;

  constructor(minProfitSOL: number = 0.01) {
    this.minProfitSOL = minProfitSOL;
  }

  /**
   * æ£€æµ‹å¥—åˆ©æœºä¼š
   */
  async detectOpportunities(): Promise<ArbitrageOpportunity[]> {
    // TODO: å®ç°æ‚¨çš„ç­–ç•¥é€»è¾‘
    const opportunities: ArbitrageOpportunity[] = [];
    
    // ç¤ºä¾‹ï¼šæ£€æµ‹ä»·æ ¼å·®å¼‚
    // ...
    
    return opportunities;
  }

  /**
   * è¯„ä¼°æœºä¼šæ˜¯å¦å€¼å¾—æ‰§è¡Œ
   */
  isWorthExecuting(opportunity: ArbitrageOpportunity): boolean {
    return opportunity.profitSOL >= this.minProfitSOL;
  }
}
```

ç„¶åç¼–è¯‘æµ‹è¯•ï¼š
```bash
npm run build
node test-local-complete.js
```

---

## ğŸ§ª æ¨¡æ‹Ÿæµ‹è¯•æŠ€å·§

### **1. ä½¿ç”¨Mockæ•°æ®**

```javascript
// æ¨¡æ‹ŸJupiter Quote
const mockQuote = {
  inputMint: 'SOL',
  outputMint: 'USDC',
  inAmount: '100000000',
  outAmount: '18500000',
  priceImpactPct: '0.15',
};

// æµ‹è¯•åˆ©æ¶¦è®¡ç®—
const profit = calculateProfit(mockQuote);
console.log(`é¢„æœŸåˆ©æ¶¦: ${profit} SOL`);
```

### **2. æµ‹è¯•è¾¹ç•Œæ¡ä»¶**

```javascript
// æµ‹è¯•æœ€å°åˆ©æ¶¦é˜ˆå€¼
const testCases = [
  { profit: 0.005, shouldExecute: false },
  { profit: 0.01, shouldExecute: true },
  { profit: 0.05, shouldExecute: true },
];

for (const test of testCases) {
  const result = isWorthExecuting(test.profit);
  console.log(`Profit ${test.profit}: ${result === test.shouldExecute ? 'âœ…' : 'âŒ'}`);
}
```

### **3. æµ‹è¯•é£é™©æ§åˆ¶**

```javascript
// æµ‹è¯•æ»‘ç‚¹ä¿æŠ¤
const riskChecks = {
  slippage: 0.5,  // 0.5%
  maxSlippage: 2.0,  // 2.0%
};

const isRiskAcceptable = riskChecks.slippage <= riskChecks.maxSlippage;
console.log(`é£é™©æ£€æŸ¥: ${isRiskAcceptable ? 'âœ… é€šè¿‡' : 'âŒ æ‹’ç»'}`);
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### **1. æ·»åŠ æ—¥å¿—**

```typescript
import { logger } from '../logger';

const swapLogger = logger.child({ module: 'MyStrategy' });

swapLogger.info('å¼€å§‹æ£€æµ‹å¥—åˆ©æœºä¼š');
swapLogger.debug('è¾“å…¥å‚æ•°', { amount, tokenPair });
swapLogger.warn('åˆ©æ¶¦ä½äºé˜ˆå€¼', { profit, threshold });
swapLogger.error('æ‰§è¡Œå¤±è´¥', error);
```

### **2. ä½¿ç”¨è°ƒè¯•å™¨**

```bash
# VSCodeè°ƒè¯•é…ç½®
# æŒ‰F5å¯åŠ¨è°ƒè¯•
```

### **3. å•å…ƒæµ‹è¯•**

åˆ›å»º `packages/core/src/__tests__/profit-calculator.test.ts`ï¼š

```typescript
import { calculateProfit } from '../economics/profit-analyzer';

describe('Profit Calculator', () => {
  test('åº”è¯¥æ­£ç¡®è®¡ç®—å‡€åˆ©æ¶¦', () => {
    const result = calculateProfit({
      inputAmount: 0.1,
      outputAmount: 0.105,
      fees: 0.00015,
    });
    
    expect(result).toBeCloseTo(0.00485, 5);
  });
});
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### **1. æ‰¹é‡å¤„ç†**

```typescript
// æ‰¹é‡è·å–å¤šä¸ªæ± å­çš„ä»·æ ¼
const prices = await Promise.all([
  getPoolPrice(pool1),
  getPoolPrice(pool2),
  getPoolPrice(pool3),
]);
```

### **2. ç¼“å­˜æœºåˆ¶**

```typescript
const cache = new Map<string, CachedData>();

function getCachedPrice(poolId: string): number | null {
  const cached = cache.get(poolId);
  if (cached && Date.now() - cached.timestamp < 1000) {
    return cached.price;
  }
  return null;
}
```

### **3. å¹¶å‘æ§åˆ¶**

```typescript
import PQueue from 'p-queue';

const queue = new PQueue({ concurrency: 10 });

// é™åˆ¶å¹¶å‘è¯·æ±‚æ•°
await queue.add(() => fetchPoolData(poolId));
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### **é˜¶æ®µ1: æœ¬åœ°å¼€å‘ï¼ˆå½“å‰ï¼‰âœ…**
- [x] ç¯å¢ƒæ­å»º
- [x] æ ¸å¿ƒåŠŸèƒ½éªŒè¯
- [ ] ç­–ç•¥å¼€å‘
- [ ] å•å…ƒæµ‹è¯•

### **é˜¶æ®µ2: æœ¬åœ°çœŸå®æµ‹è¯•**
- [ ] å®‰è£…Solana CLI
- [ ] å¯åŠ¨æœ¬åœ°æµ‹è¯•ç½‘
- [ ] çœŸå®äº¤æ˜“æµ‹è¯•

### **é˜¶æ®µ3: Devnetæµ‹è¯•**
- [ ] é…ç½®Devnetè¿æ¥
- [ ] å°é‡‘é¢æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–

### **é˜¶æ®µ4: ç”Ÿäº§éƒ¨ç½²**
- [ ] VPSéƒ¨ç½²
- [ ] Mainnetæµ‹è¯•
- [ ] ç›‘æ§å’Œå‘Šè­¦

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„DEXæ”¯æŒï¼Ÿ

A: åœ¨ `packages/onchain-bot/src/parsers/` æ·»åŠ æ–°çš„è§£æå™¨ï¼š

```typescript
// new-dex.ts
export class NewDexParser {
  parsePoolData(accountData: Buffer): PoolInfo {
    // å®ç°è§£æé€»è¾‘
  }
}
```

### Q: å¦‚ä½•è°ƒæ•´åˆ©æ¶¦é˜ˆå€¼ï¼Ÿ

A: ä¿®æ”¹é…ç½®æ–‡ä»¶ `configs/devnet-test.toml`ï¼š

```toml
[trading]
min_profit_sol = 0.001  # æ”¹ä¸ºæ‚¨æœŸæœ›çš„é˜ˆå€¼
```

### Q: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Ÿ

A: è®¾ç½®æ—¥å¿—çº§åˆ«ä¸ºdebugï¼š

```bash
# .envæ–‡ä»¶
LOG_LEVEL=debug
```

---

## ğŸ“š èµ„æºé“¾æ¥

- [Solanaæ–‡æ¡£](https://docs.solana.com/)
- [Jupiter APIæ–‡æ¡£](https://station.jup.ag/docs)
- [Jitoæ–‡æ¡£](https://jito-labs.gitbook.io/)
- [TypeScriptæ–‡æ¡£](https://www.typescriptlang.org/docs/)

---

## âœ… æ£€æŸ¥æ¸…å•

å¼€å§‹å¼€å‘å‰ç¡®è®¤ï¼š

- [x] ä»£ç ç¼–è¯‘æˆåŠŸ
- [x] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [x] ç†è§£é¡¹ç›®ç»“æ„
- [ ] é˜…è¯»æ ¸å¿ƒä»£ç 
- [ ] è®¾è®¡æ‚¨çš„ç­–ç•¥
- [ ] å¼€å§‹ç¼–ç ï¼

---

ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€
