# æ·±åº¦æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆSimulate To Bundleï¼‰ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

**æ·±åº¦æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆSimulate To Bundleï¼‰**æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æµ‹è¯•åŠŸèƒ½ï¼Œå®ƒä¼šæ‰§è¡Œå¥—åˆ©äº¤æ˜“çš„**æ‰€æœ‰çœŸå®æ­¥éª¤**ï¼Œä½†åœ¨æœ€åä¸€æ­¥ï¼ˆå‘é€Bundleåˆ°é“¾ä¸Šï¼‰ä¹‹å‰åœæ­¢ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### âœ… æ‰§è¡Œçš„çœŸå®æ“ä½œ

1. âœ… **çœŸå®ç›‘æ§æœºä¼š** - ä½¿ç”¨WorkeræŒç»­æ‰«æJupiterå¸‚åœº
2. âœ… **çœŸå®æ„å»ºswapæŒ‡ä»¤** - è°ƒç”¨Jupiter Ultra API `/swap-instructions`
3. âœ… **çœŸå®ç­¾åäº¤æ˜“** - ä½¿ç”¨é’±åŒ…ç§é’¥ç­¾å
4. âœ… **çœŸå®è®¡ç®—Tip** - ä½¿ç”¨JitoTipOptimizerè®¡ç®—æœ€ä¼˜å°è´¹
5. âœ… **çœŸå®æ„å»ºBundle** - åˆ›å»ºå®Œæ•´çš„Jito Bundleï¼ˆå¥—åˆ©äº¤æ˜“ + Tipäº¤æ˜“ï¼‰

### âŒ ä¸æ‰§è¡Œçš„æ“ä½œ

6. âŒ **ä¸å‘é€Bundleåˆ°Jito** - ä¸ä¼šæäº¤åˆ°Block Engine
7. âŒ **ä¸æ¶ˆè€—gasè´¹ç”¨** - æ²¡æœ‰ä»»ä½•é“¾ä¸Šè´¹ç”¨

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. é…ç½®æ–‡ä»¶è®¾ç½®

åœ¨ `configs/flashloan-dryrun.toml` ä¸­å¯ç”¨ï¼š

```toml
[bot]
name = "flashloan-arbitrage-bot-dryrun"
network = "mainnet-beta"
dry_run = true  # ğŸ”´ å¹²è¿è¡Œæ¨¡å¼
simulate_to_bundle = true  # ğŸ”¥ æ·±åº¦æ¨¡æ‹Ÿï¼šæ„å»ºBundleä½†ä¸ä¸Šé“¾
```

### 2. è¿è¡ŒBot

```bash
npm run start:flashloan:dryrun
```

### 3. è§‚å¯Ÿè¾“å‡º

å½“å‘ç°å¥—åˆ©æœºä¼šå¹¶æ„å»ºå®Œæˆæ—¶ï¼Œä½ ä¼šçœ‹åˆ°ï¼š

```
ğŸ­ [SIMULATE_TO_BUNDLE] Bundle built successfully but NOT sending to chain
ğŸ“¦ Bundle Details:
   - Tip: 5000000 lamports (0.005000 SOL)
   - Expected Profit: 8000000 lamports (0.008000 SOL)
   - Net Profit: 3000000 lamports (0.003000 SOL)
   - Latency (build only): 650ms
   - Bundle: Successfully constructed with arbitrage + tip transactions
```

## ğŸ“Š å¯¹æ¯”ä¸‰ç§æ¨¡å¼

| ç‰¹æ€§ | ç®€å•æ¨¡æ‹Ÿ (dry_run=true) | æ·±åº¦æ¨¡æ‹Ÿ (simulate_to_bundle=true) | çœŸå®äº¤æ˜“ |
|------|----------------------|----------------------------------|---------|
| ç›‘æ§æœºä¼š | âœ… | âœ… | âœ… |
| æ„å»ºæŒ‡ä»¤ | âŒ | âœ… | âœ… |
| ç­¾åäº¤æ˜“ | âŒ | âœ… | âœ… |
| è®¡ç®—Tip | âŒ | âœ… | âœ… |
| æ„å»ºBundle | âŒ | âœ… | âœ… |
| å‘é€åˆ°é“¾ä¸Š | âŒ | âŒ | âœ… |
| æ¶ˆè€—gas | âŒ | âŒ | âœ… |
| **é€‚ç”¨åœºæ™¯** | å¿«é€Ÿè§‚å¯Ÿ | **å®Œæ•´æµ‹è¯•** | å®é™…ç›ˆåˆ© |

## ğŸ“ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šéªŒè¯æ•´ä¸ªæµç¨‹

æµ‹è¯•ä»æœºä¼šå‘ç°åˆ°Bundleæ„å»ºçš„å®Œæ•´æµç¨‹ï¼Œç¡®ä¿ï¼š
- Jupiter APIè¿æ¥æ­£å¸¸
- SwapæŒ‡ä»¤æ„å»ºæˆåŠŸ
- é’±åŒ…ç­¾ååŠŸèƒ½æ­£å¸¸
- Jito Bundleæ„å»ºæ­£ç¡®

### åœºæ™¯2ï¼šæ€§èƒ½æµ‹è¯•

æµ‹é‡å®Œæ•´æµç¨‹çš„å»¶è¿Ÿï¼š
- Quote ageï¼ˆæŠ¥ä»·å¹´é¾„ï¼‰
- Build timeï¼ˆæ„å»ºæ—¶é—´ï¼‰
- æ€»å»¶è¿Ÿï¼ˆä»å‘ç°åˆ°å‡†å¤‡å¥½å‘é€ï¼‰

### åœºæ™¯3ï¼šç­–ç•¥ä¼˜åŒ–

è§‚å¯ŸTipä¼˜åŒ–å™¨çš„è¡Œä¸ºï¼š
- ä¸åŒæœºä¼šçš„Tipè®¡ç®—
- åˆ©æ¶¦åˆ†é…ç­–ç•¥
- ç«äº‰å¼ºåº¦è¯„ä¼°

### åœºæ™¯4ï¼šéƒ¨ç½²å‰æœ€ç»ˆæµ‹è¯•

åœ¨çœŸå®ç¯å¢ƒéƒ¨ç½²å‰ï¼Œæ‰§è¡Œå®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•ï¼Œä½†ä¸æ‰¿æ‹…ä»»ä½•èµ„é‡‘é£é™©ã€‚

## ğŸ“ æ—¥å¿—åˆ†æ

### å…³é”®æ—¥å¿—

```bash
# 1. æ¨¡å¼ç¡®è®¤
ğŸš€ é—ªç”µè´·æœºå™¨äººå·²å¯åŠ¨
æ¨¡å¼: ğŸ­ æ·±åº¦æ¨¡æ‹Ÿï¼ˆæ„å»º+ç­¾åBundleä½†ä¸ä¸Šé“¾ï¼‰

# 2. æœºä¼šå‘ç°
ğŸ¯ Opportunity found: So11... â†’ USDC â†’ So11... | Profit: 0.003500 SOL

# 3. å¹¶è¡Œå¤„ç†
ğŸš€ Starting parallel validation (stats) + build (execution)...

# 4. ä½¿ç”¨ç¼“å­˜quote
ğŸ”¥ Fetching swap instructions from cached quotes...
ğŸ“¦ Built instructions (quote_age=4ms)

# 5. Bundleæ„å»ºæˆåŠŸ
ğŸ­ [SIMULATE_TO_BUNDLE] Bundle built successfully but NOT sending to chain
ğŸ“¦ Bundle Details:
   - Tip: 5000000 lamports (0.005000 SOL)
   - Expected Profit: 8000000 lamports (0.008000 SOL)
   - Net Profit: 3000000 lamports (0.003000 SOL)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Quoteæ–°é²œåº¦

è™½ç„¶ä¸ä¸Šé“¾ï¼Œä½†quoteçš„æ–°é²œåº¦(3-4ms)è¡¨æ˜ç³»ç»Ÿå»¶è¿Ÿæä½ã€‚

### 2. Tipè®¡ç®—

Tipæ˜¯çœŸå®è®¡ç®—çš„ï¼Œåæ˜ äº†å®é™…æ‰§è¡Œæ—¶ä¼šä½¿ç”¨çš„å€¼ã€‚

### 3. é’±åŒ…ä½™é¢

- æ·±åº¦æ¨¡æ‹Ÿæ¨¡å¼ä¸‹ï¼Œ**ä¸ä¼šæ£€æŸ¥é’±åŒ…ä½™é¢**
- å› ä¸ºä¸ä¼šå®é™…æ¶ˆè€—èµ„é‡‘
- çœŸå®äº¤æ˜“å‰å¿…é¡»ç¡®ä¿é’±åŒ…æœ‰è¶³å¤Ÿä½™é¢

### 4. Leader Schedule

å¦‚æœå¯ç”¨äº†`checkJitoLeader`ï¼š
- ä»ä¼šæ£€æŸ¥Jito Leader Schedule
- éJito slotæ—¶ä¼šè·³è¿‡æ„å»º
- å¯ä»¥ä¸´æ—¶å…³é—­ä»¥å¢åŠ æµ‹è¯•æœºä¼š

## ğŸ”§ é…ç½®å»ºè®®

### æµ‹è¯•é…ç½®ï¼ˆæœ€å¤§åŒ–æœºä¼šï¼‰

```toml
[bot]
dry_run = true
simulate_to_bundle = true

# é™ä½é˜ˆå€¼ä»¥è·å¾—æ›´å¤šæµ‹è¯•æœºä¼š
[economics.profitability]
min_profit_lamports = 100_000  # 0.0001 SOL

[economics.risk]
max_loss_lamports = 1_000_000  # 0.001 SOL

# ä¸´æ—¶å…³é—­Leaderæ£€æŸ¥
[jito]
check_jito_leader = false  # å¢åŠ æµ‹è¯•æœºä¼š
```

### ç”Ÿäº§å‰éªŒè¯é…ç½®ï¼ˆä½¿ç”¨çœŸå®é˜ˆå€¼ï¼‰

```toml
[bot]
dry_run = true
simulate_to_bundle = true

# ä½¿ç”¨çœŸå®çš„åˆ©æ¶¦é˜ˆå€¼
[economics.profitability]
min_profit_lamports = 2_000_000  # 0.002 SOL

# ä½¿ç”¨çœŸå®çš„é£é™©æ§åˆ¶
[economics.risk]
max_loss_lamports = 500_000  # 0.0005 SOL

# å¯ç”¨Leaderæ£€æŸ¥
[jito]
check_jito_leader = true
```

## ğŸš€ ä»æ¨¡æ‹Ÿåˆ°ç”Ÿäº§

### æ­¥éª¤1ï¼šæ·±åº¦æ¨¡æ‹Ÿæµ‹è¯•ï¼ˆ1å°æ—¶ï¼‰

```bash
# ä½¿ç”¨æ·±åº¦æ¨¡æ‹Ÿæ¨¡å¼
npm run start:flashloan:dryrun

# è§‚å¯Ÿï¼š
# - æœºä¼šå‘ç°é¢‘ç‡
# - Bundleæ„å»ºæˆåŠŸç‡
# - å¹³å‡Tip
# - å¹³å‡å»¶è¿Ÿ
```

### æ­¥éª¤2ï¼šå…³é—­æ¨¡æ‹Ÿï¼Œå°é¢æµ‹è¯•ï¼ˆ1å°æ—¶ï¼‰

```toml
[bot]
dry_run = false  # âš ï¸ å…³é—­æ¨¡æ‹Ÿ
simulate_to_bundle = false

# ä½¿ç”¨å°é¢èµ„é‡‘
[flashloan.solend]
max_borrow_amount = 100_000_000  # 0.1 SOL
```

### æ­¥éª¤3ï¼šæ­£å¸¸é‡‘é¢è¿è¡Œ

```toml
[flashloan.solend]
max_borrow_amount = 10_000_000_000  # 10 SOLï¼ˆæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ï¼‰
```

## ğŸ“Š é¢„æœŸè¾“å‡º

### æˆåŠŸçš„æ·±åº¦æ¨¡æ‹Ÿ

```
=========================================
   ç»Ÿè®¡ä¿¡æ¯
=========================================
è¿è¡Œæ—¶é—´: 01:00:00
æœºä¼šå‘ç°: 127
æœºä¼šè¿‡æ»¤: 115
äº¤æ˜“å°è¯•: 12
äº¤æ˜“æˆåŠŸ: 12 (100%)  â† æ¨¡æ‹ŸæˆåŠŸ
æ€»åˆ©æ¶¦: 0.0450 SOL  â† ç†è®ºåˆ©æ¶¦
```

**æ³¨æ„**ï¼š`äº¤æ˜“æˆåŠŸ: 12 (100%)` è¡¨ç¤ºBundleæ„å»ºæˆåŠŸï¼Œä¸æ˜¯çœŸå®ä¸Šé“¾ã€‚

## ğŸ’¡ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæ²¡æœ‰å‘ç°æœºä¼š

**åŸå› **ï¼šåˆ©æ¶¦é˜ˆå€¼å¤ªé«˜

**è§£å†³**ï¼šä¸´æ—¶é™ä½é˜ˆå€¼
```toml
min_profit_lamports = 50_000  # 0.00005 SOL
```

### é—®é¢˜2ï¼šæ„å»ºå¤±è´¥

**åŸå› **ï¼šå¯èƒ½æ˜¯Jupiter APIé—®é¢˜æˆ–ç½‘ç»œé—®é¢˜

**æ£€æŸ¥**ï¼š
1. API Keyæ˜¯å¦æ­£ç¡®
2. ç½‘ç»œè¿æ¥æ˜¯å¦ç¨³å®š
3. Jupiter APIé™æµï¼ˆåº”è¯¥ä½¿ç”¨API Keyé¿å…ï¼‰

### é—®é¢˜3ï¼šBundleæ„å»ºå»¶è¿Ÿå¤ªé«˜

**åŸå› **ï¼šç½‘ç»œå»¶è¿Ÿæˆ–RPCæ€§èƒ½é—®é¢˜

**ä¼˜åŒ–**ï¼š
1. ä½¿ç”¨é«˜æ€§èƒ½RPCï¼ˆHelius Pro, QuickNodeç­‰ï¼‰
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. ä½¿ç”¨å°±è¿‘çš„RPCèŠ‚ç‚¹

## ğŸ“– æŠ€æœ¯å®ç°

### ä»£ç ä½ç½®

**é…ç½®è§£æ**ï¼š`packages/jupiter-bot/src/flashloan-bot.ts`
```typescript
simulateToBundle: config.bot.simulate_to_bundle
```

**æ‰§è¡Œé€»è¾‘**ï¼š`packages/onchain-bot/src/executors/jito-executor.ts`
```typescript
if (this.config.simulateToBundle) {
  // æ˜¾ç¤ºè¯¦æƒ…ä½†ä¸å‘é€bundle
  logger.info('ğŸ­ [SIMULATE_TO_BUNDLE] Bundle built successfully...');
  return { success: true, bundleId: 'SIMULATED', ... };
}
// å¦åˆ™å‘é€bundleåˆ°Jito
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-25  
**ä½œè€…**: AI Assistant

