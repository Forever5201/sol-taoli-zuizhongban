@echo off
REM ============================================================================
REM Meteora DLMM ç»“æ„ä¿®å¤ - å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹
REM ============================================================================

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘     Meteora DLMM ç»“æ„ä¿®å¤å·¥å…· v1.0                            â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

echo [ç¬¬1æ­¥] æ£€æŸ¥ä¾èµ–...
where tsx >nul 2>nul
if %errorlevel% neq 0 (
    echo âŒ æœªæ‰¾åˆ° tsxï¼Œæ­£åœ¨å®‰è£…...
    call pnpm install
)

echo.
echo [ç¬¬2æ­¥] åˆ†æé“¾ä¸Šè´¦æˆ·æ•°æ®...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
call tsx tools/analyze-meteora-account.ts
if %errorlevel% neq 0 (
    echo âŒ è´¦æˆ·åˆ†æå¤±è´¥ï¼
    goto :error
)

echo.
echo [ç¬¬3æ­¥] è·å–Meteora DLMM IDL...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
call tsx tools/fetch-meteora-idl.ts
if %errorlevel% neq 0 (
    echo âš ï¸  IDLè·å–å¤±è´¥ï¼Œå°†ä½¿ç”¨æ‰‹åŠ¨åˆ†æç»“æœ
)

echo.
echo [ç¬¬4æ­¥] è¿è¡Œç»“æ„ä½“å¤§å°éªŒè¯æµ‹è¯•...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
cargo test --test struct_size_validation -- --nocapture
if %errorlevel% neq 0 (
    echo âš ï¸  æµ‹è¯•å‘ç°å¤§å°ä¸åŒ¹é…ï¼Œè¯·æŸ¥çœ‹è¾“å‡º
)

echo.
echo [ç¬¬5æ­¥] æ£€æŸ¥åˆ†æç»“æœ...
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if exist "analysis-results\JUP-USDC-analysis.json" (
    echo âœ… åˆ†æç»“æœå·²ç”Ÿæˆ:
    echo    - analysis-results/JUP-USDC-account-data.bin
    echo    - analysis-results/JUP-USDC-analysis.json
) else (
    echo âš ï¸  æœªæ‰¾åˆ°åˆ†æç»“æœæ–‡ä»¶
)

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘     ä¿®å¤æµç¨‹å®Œæˆï¼                                             â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo ğŸ“‹ ä¸‹ä¸€æ­¥:
echo   1. æŸ¥çœ‹ analysis-results/ ç›®å½•ä¸­çš„åˆ†æç»“æœ
echo   2. å¯¹æ¯” meteora_dlmm.rs ä¸­çš„ç»“æ„å®šä¹‰
echo   3. å¦‚æœç”Ÿæˆäº† meteora_dlmm_generated.rsï¼Œè¯·æ£€æŸ¥å¹¶æ›¿æ¢
echo   4. è¿è¡Œ: cargo build --release
echo   5. æµ‹è¯•: target/release/solana-pool-cache config.toml
echo.
pause
goto :end

:error
echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘     ä¿®å¤å¤±è´¥ï¼è¯·æŸ¥çœ‹ä¸Šæ–¹é”™è¯¯ä¿¡æ¯                               â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
pause
exit /b 1

:end




