# 🚀 快速启动指南

## ✅ 当前状态

✅ **数据库集成已完成** - 代码已准备好记录套利机会  
✅ **环境变量已配置** - .env 文件已创建  
✅ **微信推送已配置** - Server酱可以发送通知  
⚠️ **数据库功能暂时禁用** - 需要安装 PostgreSQL 后启用

## 🎯 两种启动方式

### 方式 1: 立即开始（不记录历史数据）

**适合**: 想立即测试机器人，稍后再配置数据库

```powershell
# 直接启动机器人
pnpm start --config ./configs/flashloan-serverchan.toml
```

机器人会正常运行：
- ✅ 扫描套利机会
- ✅ 执行盈利交易
- ✅ 发送微信通知
- ❌ 不记录历史数据到数据库

### 方式 2: 完整配置（推荐）

**适合**: 想要记录所有数据，进行历史分析

#### 步骤 1: 安装 PostgreSQL

参考 [DATABASE_SETUP_WINDOWS.md](./DATABASE_SETUP_WINDOWS.md) 完整指南

或快速安装：

1. 下载: https://www.postgresql.org/download/windows/
2. 安装，密码设置为: `arbitrage_password`
3. 完成安装

#### 步骤 2: 配置数据库

```powershell
# 运行自动配置脚本
.\setup-database.bat
```

如果脚本失败，手动创建数据库：

```powershell
# 打开 psql
& 'C:\Program Files\PostgreSQL\15\bin\psql.exe' -U postgres

# 执行以下命令
CREATE USER arbitrage_user WITH PASSWORD 'arbitrage_password';
CREATE DATABASE arbitrage_db;
GRANT ALL PRIVILEGES ON DATABASE arbitrage_db TO arbitrage_user;
\q
```

#### 步骤 3: 启用数据库记录

编辑 `configs/flashloan-serverchan.toml`，找到第 142 行：

```toml
[database]
enabled = true  # 改为 true
```

#### 步骤 4: 启动机器人

```powershell
pnpm start --config ./configs/flashloan-serverchan.toml
```

## 📊 验证数据库记录

如果启用了数据库，启动后会看到：

```
[FlashloanBot] Database initialized for opportunity recording
[OpportunityFinder] Database recording enabled for opportunities
```

发现机会时：

```
[OpportunityFinder] 🎯 Opportunity found: So11... → USDT → So11... | Profit: 0.005102 SOL
[OpportunityFinder] Opportunity recorded to database: 0.005102 SOL  ← 这行表示已记录
```

### 查看记录的数据

打开数据库管理界面：

```powershell
cd packages\core
pnpm db:studio
```

浏览器会自动打开 http://localhost:5555

## 📱 微信通知

无论是否启用数据库，微信通知都会正常工作：

- 💰 套利成功通知
- ❌ 错误告警
- 🚨 熔断保护
- 📊 性能统计

## 🎯 记录的数据

当数据库启用时，系统会记录：

### 套利机会（通过阈值的）

- 输入/输出代币
- 桥接代币
- 预期利润
- ROI 百分比
- 路由详情
- 发现时间

**阈值**: 利润 >= 0.005 SOL（配置文件中的 `min_profit_lamports`）

### 查询示例

```sql
-- 查看今天发现的所有机会
SELECT 
  bridge_token,
  expected_profit / 1000000000.0 as profit_sol,
  expected_roi,
  created_at
FROM opportunities
WHERE created_at >= CURRENT_DATE
ORDER BY expected_profit DESC;

-- 统计今天的机会数量
SELECT COUNT(*) FROM opportunities WHERE created_at >= CURRENT_DATE;

-- 查看最赚钱的桥接代币
SELECT 
  bridge_token,
  COUNT(*) as count,
  AVG(expected_roi) as avg_roi,
  SUM(expected_profit) / 1000000000.0 as total_profit_sol
FROM opportunities
GROUP BY bridge_token
ORDER BY total_profit_sol DESC;
```

## 🔧 切换模式

### 从无数据库切换到有数据库

1. 安装 PostgreSQL
2. 运行 `setup-database.bat`
3. 修改配置文件 `database.enabled = true`
4. 重启机器人

### 从有数据库切换到无数据库

1. 修改配置文件 `database.enabled = false`
2. 重启机器人

数据仍然保存在数据库中，只是不会再记录新数据。

## 💡 推荐方案

### 🏃 现在立即开始

```powershell
# 使用方式 1，立即启动
pnpm start --config ./configs/flashloan-serverchan.toml
```

### 📊 稍后启用数据库

等机器人运行一段时间后，如果觉得需要历史数据分析：

1. 停止机器人（Ctrl+C）
2. 安装 PostgreSQL
3. 运行 `setup-database.bat`
4. 修改配置启用数据库
5. 重启机器人

从此刻开始，所有新发现的机会都会被记录！

## 📚 相关文档

- [DATABASE_SETUP_WINDOWS.md](./DATABASE_SETUP_WINDOWS.md) - 详细的数据库安装指南
- [DATABASE_INTEGRATION_COMPLETE.md](./DATABASE_INTEGRATION_COMPLETE.md) - 技术实现细节
- [SERVER_CHAN_GUIDE.md](./SERVER_CHAN_GUIDE.md) - 微信通知配置

---

**建议**: 先用方式 1 测试机器人是否正常工作，然后再决定是否需要数据库记录功能。


