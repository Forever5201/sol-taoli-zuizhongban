# 启动数据库仪表板 - 重要说明

## ❗ 关于npm run命令的问题

您遇到的错误是因为项目使用了**pnpm workspace**（monorepo结构）。

### 为什么`npm run dashboard`不能用？

在monorepo环境中，当您在根目录运行`npm run xxx`时，npm会尝试在所有子包（workspace）中查找并执行这个脚本。由于子包的package.json中没有定义`dashboard`脚本，所以会报错：

```
npm error Missing script: "dashboard"
```

## ✅ 正确的启动方式

### 方法1：使用批处理脚本（最简单）

在项目根目录直接双击或运行：

```bash
start-dashboard.bat
```

或者：

```bash
scripts\start-dashboard.bat
```

### 方法2：使用npx直接运行

在项目根目录打开命令行：

```bash
npx tsx tools/dashboard-api.ts
```

## 🔍 验证启动成功

启动后，您应该看到类似输出：

```
╔══════════════════════════════════════════╗
║  📊 数据库仪表板 API 服务器已启动        ║
╚══════════════════════════════════════════╝

🌐 访问地址: http://localhost:3000
📡 API 端点: http://localhost:3000/api/*
```

然后在浏览器访问：`http://localhost:3000`

## 📝 其他说明

### 首次运行前的准备

1. **确保PostgreSQL正在运行**
   ```bash
   # Windows上检查服务
   services.msc
   # 查找PostgreSQL服务
   ```

2. **生成Prisma Client**（如果还没生成）
   ```bash
   cd packages\core
   npx prisma generate
   cd ..\..
   ```

3. **检查数据库连接配置**
   - 默认连接字符串：`postgresql://arbitrage_user:your_password_here@localhost:5432/arbitrage_db`
   - 可以通过环境变量`DATABASE_URL`覆盖

### 常见问题

**Q: 端口3000已被占用怎么办？**

A: 修改`tools/dashboard-api.ts`中的`PORT`变量：
```typescript
const PORT = 3001;  // 改成其他端口
```

**Q: 数据库连接失败？**

A: 检查：
1. PostgreSQL服务是否运行
2. 数据库用户名密码是否正确
3. 数据库是否已创建

**Q: 页面显示但没有数据？**

A: 这是正常的！需要：
1. 启动闪电贷机器人收集数据
2. 确保配置文件中启用了数据库记录

## 📚 相关文档

- **快速开始**：`数据库仪表板-快速开始.md`
- **详细指南**：`docs/dashboard-usage.md`
- **实施报告**：`数据库仪表板实施完成报告.md`

---

**总结**：不要使用`npm run dashboard`，改用`start-dashboard.bat`或`npx tsx tools/dashboard-api.ts`！

